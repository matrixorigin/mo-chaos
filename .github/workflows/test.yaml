name: Just for Test
on:
  workflow_dispatch:
jobs:
  bvt_test:
    name: MO CHECKIN BVT TEST
    runs-on: amd64-tke-mo
    steps:
      - name: Clone MO-Tester
        uses: actions/checkout@v3
        with:
          repository: matrixorigin/mo-tester
          path: ./mo-tester
          ref: main
      - name: Clone matrixone Repo
        uses: actions/checkout@v3
        with:
          repository: matrixorigin/matrixone
          ref: main
          path: .
#      - name: Download mo cluster artifact
#        uses: actions/download-artifact@v3
#        with:
#          name: mo-cluster
#          path: .
      - name: Set JAVA PATH
        run: |
          echo "$JAVA_HOME/bin" >> $GITHUB_PATH
      - name: Generate MO-Tester Config and Start BVT Test
        timeout-minutes: 20
        run: |
          pwd
          ls
          name=cbhufqauf1n8p599
          NAMESPACE=chaos-$name
          export LC_ALL="C.UTF-8"
          locale
          sed -i "s/127.0.0.1:6001/$name-tp-cn.$NAMESPACE:6001/" ./mo-tester/mo.yml
          sed -i 's/socketTimeout:.*/socketTimeout: 300000/g' ./mo-tester/mo.yml
          sed -i 's/waittime:.*/waittime: 2000/g' ./mo-tester/run.yml
          cat ./mo-tester/mo.yml
          echo "=========================="
          cat ./mo-tester/run.yml
          echo "=========================="
          
          cd $GITHUB_WORKSPACE/mo-tester
          ./run.sh -n -g -o -p $GITHUB_WORKSPACE/matrixone/test/distributed/cases -s /matrixone/test/distributed/resources -e optimistic  2>&1
          rm -rf .git lib